# Build worker image (VM template)
image: Visual Studio 2015

# scripts that are called at very beginning, before repo cloning
init:
  - git config --global core.autocrlf input

version: 1.0.{build}

# enable patching of AssemblyInfo.* files
assembly_info:
  patch: true
  file: AssemblyInfo.*
  assembly_version: "1.0.{build}"
  assembly_file_version: "{version}"
  assembly_informational_version: "{version}"

platform: Any CPU

configuration: Release

before_build:
- dotnet restore -v Minimal

build_script:
- dotnet build "src\StrangerData" --configuration RELEASE
- dotnet build "src\StrangerData.SqlServer" --configuration RELEASE
- dotnet build "test\StrangerData.UnitTests" --configuration RELEASE

after_build:
- dotnet pack src\StrangerData --configuration RELEASE --output .
- dotnet pack src\StrangerData.SqlServer --configuration RELEASE --output .

deploy:
  - provider: NuGet
    server: https://www.nuget.org/api/v2/package
    api_key:
      secure: ingFtxQjecEsrc2Ma2S259/K78gtFObeHFmbiDo2LQnGzgDL0l4TbRY+F1COVmZo
    artifact: /.*.nupkg/
    on:
      branch: master

test:
    assemblies:
    - 'test\StrangerData.UnitTests\bin\Debug\net452\win7-x64\*.dll'